DBMS:
postgresql

Error:
org.postgresql.util.PSQLException: ERROR: relation "target_strata_xref" does not exist
  Position: 402

SQL:
INSERT INTO scratch.cohort (
    cohort_definition_id,
    subject_id,
    cohort_start_date,
    cohort_end_date
  )
  -- T > X;
  select 
  s.cohort_definition_id,
  s.subject_id,
  s.cohort_start_date,
  s.cohort_end_date
  from scratch.cohort_stg as s
  inner join (
    SELECT cs.cohort_definition_id
    FROM cohort_summary cs
    INNER JOIN (SELECT DISTINCT target_id cohort_definition_id FROM TARGET_STRATA_XREF) t 
                ON t.cohort_definition_id = cs.cohort_definition_id 
                where cs.num_persons > 5
                UNION ALL
                -- Bulk strata cohorts will contain only 1 entry
                -- so they must be identified by the presence of only a single
                -- cohort_type
                SELECT DISTINCT xref.cohort_id
                FROM (
                  SELECT strata_id, target_id, COUNT(DISTINCT cohort_type) cnt
                  FROM TARGET_STRATA_XREF
                  group by strata_id, target_id HAVING COUNT(DISTINCT cohort_type) = 1
                ) single
                INNER JOIN TARGET_STRATA_XREF xref ON single.strata_id = xref.strata_id
                AND single.target_id = xref.target_id
    ) cs1 on s.cohort_definition_id = cs1.cohort_definition_id
    union all
    -- TwS and TwoS  > X
    select 
    s.cohort_definition_id,
    s.subject_id,
    s.cohort_start_date,
    s.cohort_end_date
    from scratch.cohort_stg as s
    inner join (
      SELECT cr1.cohort_id cohort_definition_id
      from TARGET_STRATA_XREF cr1
      inner join cohort_summary cs1
      on cr1.cohort_id = cs1.cohort_definition_id
      inner join TARGET_STRATA_XREF cr2
      on cr1.target_id = cr2.target_id
      and cr1.strata_id = cr2.strata_id
      and cr1.cohort_type <> cr2.cohort_type
      inner join cohort_summary cs2
      on cr2.cohort_id = cs2.cohort_definition_id 
      where cs1.num_persons > 5
      and cs2.num_persons > 5
    ) cs1 ON s.cohort_definition_id = cs1.cohort_definition_id
    

R version:
R version 4.2.2 (2022-10-31)

Platform:
x86_64-apple-darwin17.0

Attached base packages:
- stats
- graphics
- grDevices
- utils
- datasets
- methods
- base

Other attached packages:
- dplyr (1.1.0)
- DatabaseConnector (6.0.0)
- testthat (3.1.6)